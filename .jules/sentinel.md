## 2024-05-23 - Critical Auth Middleware Flaws
**Vulnerability:** Admin authentication middleware relied on fragile manual cookie header parsing (`req.headers.cookie.split(";")[0]`) and a hardcoded secret (`"ASSIGNMENT3$"`) for token verification, while the login logic used a dynamic secret.
**Learning:** This created a double vulnerability: 1) Admin access would fail if `admin_token` wasn't the first cookie (DoS/UX), and 2) Admin access was fundamentally broken or insecure if `JWT_SECRET` was ever properly set/rotated, as the middleware wouldn't verify tokens signed with the new key.
**Prevention:** Always use established middleware like `cookie-parser` for cookie handling instead of manual string parsing. Ensure token verification uses the same secret source (environment variable or centralized utility) as token signing.
